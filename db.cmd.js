db.getCollection("_User").updateMany(
  {},
  { "$set": { "isVip": false } }
)

db.getCollection("_User").updateMany(
  {
    "placeId": { "$exists": true },
    "$expr": { "$lt": [{ "$strLenCP": "$placeId" }, 27] }
  },
  { "$set": { "placeId": "ChIJ0T2NLikpdTERKxE8d61aX_E" } }
)

db.getCollection("_User").updateMany(
  {
    "placeId": { "$exists": false },
  },
  { "$set": { "placeId": "ChIJ0T2NLikpdTERKxE8d61aX_E" } }
)

db.getCollection("_User").updateMany(
  {
    "addContact": { "$exists": false },
  },
  { "$set": { "addContact": false } }
)

db.getCollection("_User").updateMany(
  {
    "autoSharing": { "$exists": false },
  },
  { "$set": { "autoSharing": true } }
)

db.getCollection("UserFollowingHistory").updateMany(
  {
    "addContact": { "$exists": false },
  },
  { "$set": { "addContact": false } }
)

db.getCollection("UserFollowingHistory").updateMany(
  {
    "addContact": { "$exists": false },
  },
  { "$set": { "addContact": false } }
)

db.getCollection("_Session").delete({ _p_user: "_User$TE6Dt85MPL" })

db.getCollection("Comment").deleteMany(
  {
    "_p_tagBizz": { "$exists": false },
    "gPlaceId": { "$exists": true, $ne: null },
    "$expr": { "$lt": [{ "$strLenCP": "$gPlaceId" }, 27] }
  }
)

db.getCollection("Comment").find(
  {
    "gPlaceId": { "$exists": true, $ne: null }
  }
)

db.getCollection("Comment").updateMany(
  {
    "gPlaceId": { "$exists": true, $ne: null }
  },
  { "$unset": ["gPlaceId"] }
)

db.TagConfig.insertMany([{ name: "RESTAURANT" }, { name: "BUSINESS" }, { name: "COFFEE" }, { name: "HOTEL" }, { name: "BAR" }])

db.getCollection("TagOfTagList").deleteMany(
  {
    "$expr": { "$lt": [{ "$strLenCP": "$tagId" }, 11] }
  }
)

db.getCollection("_User").updateMany(
  {
    "isVIP": { "$exists": true },
  },
  { "$unset": { "isVIP": "" } }
)

db.getCollection("_User").updateMany(
  {
    "followers": { "$exists": true },
  },
  {
    "$unset": { "followers": "" }
  }
)

db.Comment.aggregate([
  {
    $match: {
      $and: [
        { _p_user: { $in: ['_User\$TE6Dt85MPL'] } },
        { _created_at: { $lt: new Date() } }
      ]
    }
  },
  {
    $addFields: {
      userId: {
        $arrayElemAt: [{ $split: ['$_p_user', '_User$'] }, 1]
      },
      ref: {
        $concat: [
          { $arrayElemAt: [{ $split: ['$_p_user', '_User$'] }, 1] },
          ' ',
          '$_id',
          ' ',
          'comment'
        ]
      }
    }
  },
  {
    $limit: 1
  }
])

db.getCollection("Comment").updateMany(
  {
    "hashtags": null,
  },
  { "$set": { "hashtags": [] } }
)